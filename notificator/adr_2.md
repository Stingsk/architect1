#### ID: A002

#### Дата: 02/10/2023

#### Статус: Принято

#### Участники:
* [Волков Станислав]
* [Френки Штейн]

#### Решения:
* [Использовать Kafka как хранилище готовых к отправке сообщений]
* [Использовать отдельный сервис LimitService для учета лимитов отправки сообщений по пользователям]

#### Контекст:
После изучения различных вариантов хранения готовых к отправке сообщений было принято решение использовать Kafka,
Так как она позволяет гарантировать доставку сообщений и имеет высокую производительность. Так же Kafka позволяет гарантировать доставку сообщений в случае падения сервисов.
Так же она имеет возможность разделения на Topic поэтому в ней удобно сразу разделить потоки SMS, E-Mail и Push-уведомлений. Так же Kafka позволяет выранить нагрузку отправки сообщений в пики сезонов.

Для регулирования лимитов и учета отправленных сообщений было принято решение выделить отдельный сервис LimitService. Для учета лимитов принято решение использовать готовую базу с настройками.
Котроль лимита отправки по пользовтелю за счет учета отправленных сообщений в базе данных. Система выбирает сообщения из очереди проверяет лититы отправки по пользователям.
В случае превышения лимита, перекладывает сообщениче в топик ожидания. Сервис LimitService вычитывает сообщения из топика ожидания раз в N минут и отправляет их в топик готовых к отправке, если лимит освободился.

#### Последствия:

#### Положительные:
* [ Нет необходимости дополнительно заботится о лимитах рассылки. Сервис LimitService будет вычитывать столько сообщений сколько нужно. А первышенное количество будет надежно ждать высвобождения лимита или удаления из-за устаревания ]
* [ Не связанная с другими сервисами логика лимитов будет жить отдельно ]

#### Отрицательные:
* [ Необходимость настройки Kafka, что может быть затруднительно судя по отзывам ]
* [ Отдельный сервис на лимиты вносит дополнительную сложность в архитектуру ]
* [ Вырисовывается очень мелкая нарезка на сервисы ]
